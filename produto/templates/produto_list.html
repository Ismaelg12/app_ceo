{% extends "base.html" %}
{% load static %}
{% block datepicker %}
<!--datatables-->
<script src ="{% static "tables/jquery.min.js" %}"></script>
<style> 
  /* coloca um cor no numero de sessões da gua*/    
  .badge.badge-danger {
    background-color: #f44336;
  }
  .badge.badge-warning {
    background-color: orange;
  }
</style>
{% endblock datepicker %}

{% block container %}
<div class="content">
  <div class="container-fluid">

    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header card-header-primary" data-background-color="purple">
            <h4 class="card-title">Itens do Almoxarifado <a
              class="btn btn-success pull-right btn-round btn-fab btn-fab-mini" href="{% url 'produto_add' %}">
              <i class="material-icons">person_add</i>
              <div class="ripple-container"></div>
            </a></h4><p>Obs: A validade ativa a cor laranja quando falta 7 dias pra vencer e fica vermelho quando vencer, já o estoque fca vermelho quando está abaixo do mínimo !  </p>
          </div>
          <div class="card-content">
            <div class="material-datatables">
              <table id="datatables" class="table table-striped table-no-bordered table-hover" cellspacing="0" width="100%"
              style="width:100%">
              <thead>
                <tr>
                  <th>Nº</th>
                  <th>Produto</th>
                  <th>Validade</th>
                  <th>Estoque</th>
                  <th>Estoque mínimo</th>
                  <th>Categoria</th>
                  <th>Ação</th>
                </tr>
              </thead>
              <tbody>
                {% for object in object_list %}
                <tr>
                  <td>{{forloop.counter}}</td>
                  <td>
                    <a href="{{ object.get_absolute_url }}">{{ object.produto }}</a>
                  </td>
                  <td>{% if object.verifica_vencimento == 'Vencido' %}<span class="badge badge-danger">{{object.validade|date:"d/m/Y"}}</span> {% elif object.verifica_vencimento == 'Alerta' %} <span class="badge badge-warning">{{object.validade|date:"d/m/Y"}}</span>{% elif object.verifica_vencimento == 'Valido' %}<b>{{object.validade|date:"d/m/Y"}}</b>{% endif %}
                  </td>
                  <td>{% if object.estoque <= object.estoque_minimo %} <span class="badge badge-danger">{{object.estoque}}</span>{%else%} {{object.estoque}}{%endif%}
                  </td>
                  <td>{{ object.estoque_minimo }}</td>
                  <td>{{ object.categoria }}</td>
                  <td>
                  <a href="{% url 'produto_detail' object.id %}" title="Visualizar"><i class="material-icons">visibility</i></a>
                  <a href="{% url 'produto_edit' object.id %}" title="Editar"><i class="material-icons">sync</i>
                  </a>
                </td>
                </tr>                
                {% endfor %}
              </tbody>
            </table>
          </div>

        </div><!-- end content-->
      </div><!--  end card  -->
    </div> <!-- end col-md-12 -->
  </div> <!-- end row -->
</div>
</div>
<script type="text/javascript">
  $(document).ready(function () {
    $('#datatables').DataTable({
      "pagingType": "full_numbers",
      "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
      responsive: true,
      searching: true,
      bPaginate:true,
      "language": {
        "sProcessing": "Processando...",
        "sLengthMenu": " _MENU_ ",
        "sZeroRecords": "<b><center>Não foram encontrados resultados</center><b>",
        "info": "",
        "sInfoEmpty": "",
        "sInfoFiltered": "",
        "sInfoPostFix": "",
        "sSearch": "Busca",
        "sUrl": "",
        "oPaginate": {
          "sFirst": "Primeiro",
          "sPrevious": "",
          "sNext": "",
          "sLast": "Último"
        }
      }
    });


    var table = $('#datatables').DataTable();

// Edit record
table.on('click', '.edit', function () {
  $tr = $(this).closest('tr');

  var data = table.row($tr).data();
  alert('You press on Row: ' + data[0] + ' ' + data[1] + ' ' + data[2] + '\'s row.');
});

// Delete a record
table.on('click', '.remove', function (e) {
  $tr = $(this).closest('tr');
  table.row($tr).remove().draw();
  e.preventDefault();
});

//Like record
table.on('click', '.like', function () {
  alert('You clicked on Like button');
});

$('.card .material-datatables label').addClass('form-group');
});

</script>
{% endblock container %}